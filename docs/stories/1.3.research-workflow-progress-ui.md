# Story 1.3: Research Workflow & Progress UI

## Status
Ready

## Story
**As a** user,
**I want** to submit my company URL and see real-time research progress,
**so that** I can have an assessment session auto-created with contextual research data for my interview

## Acceptance Criteria
1. The system provides a company URL form for initial user input
2. Form submission triggers an n8n research workflow for automated company research
3. A research progress screen displays real-time feedback during the 2-5 minute research process
4. Research data is stored in Tier 1 (research_data table) with all required JSONB fields
5. Assessment session is auto-created in Tier 2 (assessment_sessions table) when research completes
6. User transitions smoothly to interview landing page when research and session creation are complete
7. Research data includes source URLs and confidence scores for downstream interview validation

## Tasks / Subtasks
- [ ] Task 1: Company URL Form Implementation (AC: 1)
  - [ ] Create company URL form component using shadcn/ui patterns
  - [ ] Implement form validation for company URL format
  - [ ] Add form submission handler with loading states
  - [ ] Create API endpoint to receive form submission and trigger research
- [ ] Task 2: N8N Research Workflow Integration (AC: 2, 4)
  - [ ] Design n8n workflow for automated company research
  - [ ] Implement webhook endpoint to trigger n8n workflow from form submission
  - [ ] Create research data processing and Tier 1 database storage
  - [ ] Add error handling for workflow failures and timeouts
  - [ ] Implement research status tracking and webhook callbacks
- [ ] Task 3: Research Progress UI Implementation (AC: 3)
  - [ ] Create research progress screen with estimated completion time
  - [ ] Implement real-time progress updates using polling or webhooks
  - [ ] Add progress indicators and status messaging (e.g., "Analyzing website...", "Gathering competitor data...")
  - [ ] Design graceful handling of research delays or errors
- [ ] Task 4: Tier 1 Database Schema Implementation (AC: 4, 7)
  - [ ] Create research_data table with complete JSONB schema
  - [ ] Implement all research data fields (web_scraping_results, social_media_analysis, financial_data, etc.)
  - [ ] Add source_urls array and confidence_scores JSONB tracking
  - [ ] Create database indexes for efficient research data access
  - [ ] Implement 90-day retention cleanup function
- [ ] Task 5: Assessment Session Auto-Creation (AC: 5)
  - [ ] Implement assessment session creation trigger on research completion
  - [ ] Link research_data_id to assessment_sessions table
  - [ ] Initialize step_data JSONB structure with 23 artifacts from research
  - [ ] Set interview_status to 'ready' and current_step to 'step_1_core_identity'
- [ ] Task 6: Interview Landing Page Transition (AC: 6)
  - [ ] Create interview landing page with assessment overview
  - [ ] Display research completion summary and artifact preview
  - [ ] Add interview start button with voice permissions request
  - [ ] Implement smooth navigation from research progress to interview landing
- [ ] Task 7: Research Data Quality & Validation (AC: 7)
  - [ ] Implement confidence scoring for each research data type
  - [ ] Add source URL tracking for all research findings
  - [ ] Create research quality validation and error reporting
  - [ ] Test research data integration with interview orchestrator requirements

## Dev Notes

### Previous Story Insights
From Story 1.1: Next.js foundation established with Supabase compatibility, API directories created (research/, interview/), environment variables framework ready for N8N integration.
From Story 1.2: Voice Agent implemented as pure I/O interface, ElevenLabs integration complete, voice interaction components ready for interview orchestrator integration.

### N8N Workflow Integration Requirements
[Source: architecture.md#MVP Data Flow Pipeline]
- **Research Trigger:** Form submission → webhook to n8n workflow → automated company research
- **Research Data Storage:** N8N workflow results → Tier 1 research_data table
- **Assessment Auto-Creation:** Research completion → trigger assessment_sessions creation
- **Workflow Hosting:** N8N hosted at https://n8n.srv758490.hstgr.cloud (from ProjectBrief.md)

### 3-Tier Database Architecture Requirements
[Source: architecture.md#3-Tier Database Architecture]
**Tier 1: Research Data (Input Layer)**
- **Purpose:** Raw intelligence from n8n research workflows
- **Lifecycle:** Created → Research complete → Used for interview → Archived (90 days)
- **Access Pattern:** N8N workflows write, Interview Orchestrator reads
- **Key Attributes:**
  - company_url: string - Company website for research
  - research_timestamp: timestamp - When research was conducted
  - web_scraping_results: jsonb - Website and content analysis
  - social_media_analysis: jsonb - Social media presence and engagement
  - financial_data: jsonb - Financial information and metrics
  - news_mentions: jsonb - Recent news and press coverage
  - competitor_data: jsonb - Competitive analysis
  - industry_analysis: jsonb - Industry trends and context
  - confidence_scores: jsonb - Quality scores for each data type
  - source_urls: string[] - Source URLs for research data
  - processing_status: string - Research completion status

**Tier 2: Assessment Sessions (Working Layer)**
- **Purpose:** Interview state management and user interaction tracking
- **Auto-Creation Trigger:** When research_data.processing_status = 'completed'
- **Initial State:** interview_status = 'ready', current_step = 'step_1_core_identity'
- **Research Link:** research_data_id references Tier 1 research

### API Endpoint Structure
[Source: architecture.md#Project Structure]
**Research API Endpoints:**
- `app/api/research/submit/route.ts` - Company URL form submission
- `app/api/research/status/[id]/route.ts` - Research progress polling
- `app/api/research/webhook/route.ts` - N8N workflow completion webhook
- `app/api/assessment/create/route.ts` - Assessment session auto-creation

### Environment Configuration Requirements
[Source: architecture.md#Environment Configuration]
Required environment variables for N8N integration:
- `N8N_WEBHOOK_URL="your-n8n-instance-url"`
- `N8N_API_KEY="your-n8n-api-key"`

### UI Component Requirements
[Source: UXUISpecification.md#Core Screens and Views]
**Company URL Form:** Clean, professional input form with single prominent CTA button
**Research Progress Page:** Progress indicator showing n8n workflow status with estimated completion time (2-5 minutes)
**Interview Landing Page:** Welcome message with assessment session overview, 9-step assessment process introduction

### File Locations
[Source: architecture.md#Project Structure]
Based on current project structure:
- Frontend components: `components/research/` directory
- API endpoints: `app/api/research/` directory
- Utilities: `lib/research/` directory
- Database types: `packages/types/research.ts` (future migration)

### Testing Standards
[Source: architecture.md#Tech Stack]
- **Testing Framework:** Unit + Integration testing as specified in technical assumptions
- Test n8n workflow integration with mock webhooks
- Test database operations with Supabase test client
- Test UI components with React Testing Library
- Test error handling for network failures and API timeouts

### Performance Requirements
[Source: prd.md#Non Functional Requirements]
- **NFR1:** System must be scalable to handle concurrent research workflows
- Optimize for efficient polling without overwhelming the server
- Implement appropriate caching for research progress updates
- Handle n8n workflow timeouts gracefully (5+ minute research processes)

### Data Security Requirements
[Source: prd.md#Non Functional Requirements]
- **NFR2:** Ensure data security for all collected business context
- Secure webhook endpoints with proper authentication
- Validate and sanitize all research data before database storage
- Implement proper error logging without exposing sensitive data

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-20 | 1.0 | Initial story creation for research workflow and progress UI | Bob (SM) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
*Results from QA Agent QA review will be populated here*